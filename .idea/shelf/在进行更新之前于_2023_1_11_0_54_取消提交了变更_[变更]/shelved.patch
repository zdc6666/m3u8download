Index: 前期判断.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># -*- coding:utf-8 -*-\r\nimport glob\r\nimport os\r\nimport ffmpy3\r\nimport requests\r\nimport re\r\nimport time\r\nimport openpyxl\r\nimport threading  # 多进程\r\nimport shipinxiazai\r\nimport random  # 随机数\r\n\r\n# https://www.lnyzyw.com/\r\n\r\n##下载链接\r\nimport pandas as pd\r\n################\r\naaa = pd.read_excel(\"qingdan.xlsx\", 0, )  # header=None,\r\nfor z in aaa.values:\r\n    shipinmingcheng = str(z).split(\"'\")[1]#获取视频名称\r\n    print(shipinmingcheng)\r\n    headers = {\r\n        \"user-agent\": \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Mobile Safari/537.36\",\r\n    }#伪装header\r\n    # 视频搜索\r\n    shipinwangzhi1 = f'https://www.lnyzyw.com/vodsearch/-------------.html?wd={shipinmingcheng}'\r\n    import requests\r\n    proxies = shipinxiazai.get_proxy()#get_proxy()为代理为None，任意数字为使用代理get_proxy(1)，或者get_proxy(\"任意字符\")\r\n    reschushi1 = requests.get(shipinwangzhi1.replace('\"', ''), headers=headers, allow_redirects=True,stream=True,\r\n                              #timeout=1,\r\n                              #proxies=proxies,\r\n                              )#timeout=(1, 1)用来分别设置请求超时时间和读取超时时间,单位为秒。\r\n    reschushi1.encoding = reschushi1.apparent_encoding\r\n    from bs4 import BeautifulSoup\r\n\r\n    bs = BeautifulSoup(reschushi1.text, 'html.parser')\r\n    # a标签下的class属性为down的，注意是class_，不是class\r\n    # xiazaiwangzhi = xiazaiwangzhibf.find_all(\"a\", class_=\"download\")\r\n    yingpian = bs.find_all(\"a\", class_=\"btn btn-min btn-primary\", )\r\n    if yingpian == []:\r\n        print(f\"影片“{shipinmingcheng}” 未找到\" )\r\n        pass\r\n    else:\r\n        print(f\"影片“{shipinmingcheng}” 已找到，准备爬取\")\r\n\r\n        aaa = \"https://www.lnyzyw.com\" + str(yingpian[0]).split('href=\"')[1].split('1.')[0] + '1' + \".html\"  # 获取影片url\r\n        yingpianwangzhi1 = requests.get(aaa.replace('\"', ''), headers=headers, allow_redirects=True,stream=True,\r\n                                        cookies=reschushi1.cookies)\r\n        from bs4 import BeautifulSoup\r\n\r\n        bs2 = BeautifulSoup(yingpianwangzhi1.text, 'html.parser')\r\n        # a标签下的class属性为down的，注意是class_，不是class\r\n        # xiazaiwangzhi = xiazaiwangzhibf.find_all(\"a\", class_=\"download\")\r\n        wangzhi = bs2.find_all(\"div\", class_=\"stui-pannel_bd col-pd clearfix\")\r\n        aaaa = re.findall(r'href=\"(.*?).html', str(wangzhi[0]))\r\n        q = 0\r\n        for w in aaaa:\r\n            q = q + 1\r\n            # 建立文件夹\r\n            dir = f\"./{shipinmingcheng}/{q}/\"#q为第几集\r\n            import os\r\n\r\n            if not os.path.exists(dir):\r\n                os.makedirs(dir)\r\n            start = \"https://www.lnyzyw.com\" + w + \".html\"#拼装视频播放url\r\n\r\n            threading.Thread(target=shipinxiazai.getVideo,\r\n                             args=[start, dir, q]).start()  # args=(start,)中逗号不能少,设置为守护线程.setDaemon(True) （如果主线程结束了，子也随之结束）\r\n\r\nffmpy3\r\nimport ffmpy3\r\npip install ffmpy3\r\nffmpeg_path('https://vip.lz-cdn3.com/20221230/16900_109d0a86/1800k/hls/mixed.m3u8', './text/gui.mp4')\r\n\r\n\r\n# dest_file=f\"./{shipinmingcheng}/第{q}集\"\r\n    # source_path=dir\r\n    # shipinxiazai.merge_to_mp4(dest_file, source_path, delete=False)\r\n#视频合并\r\naaa = pd.read_excel(\"qingdan.xlsx\", 0, )  # header=None,\r\nimport os\r\nimport shipinxiazai\r\nfor z in aaa.values:\r\n    shipinmingcheng = str(z).split(\"'\")[1]\r\n    #print(shipinmingcheng)\r\n    dir = f\"./{shipinmingcheng}/\"\r\n    try:\r\n        for i in os.listdir(dir):\r\n            source_path=dir+i+'/'\r\n            #print(source_path)\r\n            dest_file1=f'./结果/{shipinmingcheng}/'\r\n            #print(dest_file1)\r\n            if not os.path.exists(dest_file1):\r\n                os.makedirs(dest_file1)\r\n            dest_file=dest_file1+f'第{i}集.mp4'\r\n            #判断是否合并过\r\n            if not os.path.exists(dest_file):\r\n                shipinxiazai.merge_to_mp4(dest_file=dest_file, source_path=source_path, delete=False,)\r\n            else:\r\n                pass\r\n        #    if not os.path.exists(dest_file1):\r\n        #           os.makedirs(dest_file1)\r\n        #   dest_file=dest_file1+f'第{1}集.mp4'\r\n            #shipinxiazai.merge_to_mp4(dest_file=dest_file, source_path=source_path, delete=False,)\r\n    except FileNotFoundError as e:\r\n        print(e)\r\n        continue\r\nhttps://blog.csdn.net/he_spectacular/article/details/126132584\r\n\r\n#视频时长不合适的删除\r\nimport pandas as pd\r\nos.system('taskkill /f /im ffmpeg.exe')\r\naaa = pd.read_excel(\"qingdan.xlsx\", 0, )  # header=None,\r\nimport os\r\nimport shipinxiazai\r\nimport shichangpanduan\r\nfor z in aaa.values:\r\n    shipinmingcheng = str(z).split(\"'\")[1]\r\n# print(shipinmingcheng)\r\n    dir = f\"./{shipinmingcheng}/\"\r\n    try:\r\n        for i in os.listdir(dir):\r\n            video_path = dir + i\r\n            shichangpanduan.get_video_durationyou(video_path)\r\n    except FileNotFoundError as e:\r\n        print(e)\r\n        continue\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/前期判断.py b/前期判断.py
--- a/前期判断.py	(revision e4af259aae2e88e04f07fec65638a7f59b6bbaf5)
+++ b/前期判断.py	(date 1673369623365)
@@ -16,6 +16,7 @@
 import pandas as pd
 ################
 aaa = pd.read_excel("qingdan.xlsx", 0, )  # header=None,
+##############
 for z in aaa.values:
     shipinmingcheng = str(z).split("'")[1]#获取视频名称
     print(shipinmingcheng)
